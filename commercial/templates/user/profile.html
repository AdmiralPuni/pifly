<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Profile | NoFly</title>


    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    <link rel="stylesheet" href="/static/css/upalette.css">
</head>

<body class="bg-ni-sh" style="height:100vh;">
    <div class="container p-0 bg-white h-100 shadow">
        <div class="row row-cols-1 m-0 h-100">
            <div class="col p-0 h-100">
                <div class="d-flex justify-content-start h-100 w-100 ">
                    <div class="d-none d-md-flex border-end border-ni-ri bg-dark h-100" style="min-width: 20%;">
                        {% include('user/components/nav.html') %}
                    </div>
                    <div class="flex-fill p-2 h-100" style="overflow-y: scroll;">
                        <div class="d-flex mb-2 justify-content-between align-items-center p-2 border-bottom border-ni-ri">
                            <span class="fs-5">
                                User Profile
                            </span>
                            <a href="/auth/logout">
                                <button class="btn btn-danger py-1">
                                    Log Out
                                </button>
                            </a>
                        </div>
                        <div class="d-block p-0 mb-3">
                            <div class="d-block p-2 rounded-top border border-bottom-0 border-ni-ri fs-5">
                                Data Diri
                            </div>
                            <div class="d-flex flex-column rounded-bottom border border-ni-ri p-2 mb-3">
                                <div class="mb-3">
                                    <label for="form-name" class="form-label">Name</label>
                                    <input type="text" class="form-control" id="form-name">
                                </div>
                                <div class="mb-3">
                                    <label for="form-email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="form-email">
                                </div>
                                <div class="mb-3">
                                    <label for="form-phone" class="form-label">No. Hp</label>
                                    <input type="text" class="form-control" id="form-phone">
                                </div>
                                <button class="btn btn-success py-1 align-self-end" id="btn-data">
                                    Update Data
                                </button>
                            </div>
                        </div>
                        <div class="d-block p-0">
                            <div class="d-block p-2 rounded-top border border-bottom-0 border-ni-ri fs-5">
                                Ganti Password
                            </div>
                            <div class="d-flex flex-column rounded-bottom border border-ni-ri p-2 mb-3">
                                <div class="mb-3">
                                    <label for="form-old_password" class="form-label">Password Lama</label>
                                    <input type="password" class="form-control" id="form-old_password">
                                </div>
                                <div class="mb-3">
                                    <label for="form-new_password" class="form-label">Password Baru</label>
                                    <input type="password" class="form-control" id="form-new_password">
                                </div>
                                <div class="mb-3">
                                    <label for="form-new_password_retype" class="form-label">Ketik Ulang Password Baru</label>
                                    <input type="password" class="form-control" id="form-new_password_retype">
                                </div>
                                <button class="btn btn-success py-1 align-self-end" id="btn-password">
                                    Update Password
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% include('user/components/nav-mobile.html') %}
    </div>
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-white">
                <i class="bi fs-5 me-2" id="toast-color"></i>
                <strong class="me-auto fs-5" id="toast-header">Bootstrap</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body bg-white" id="toast-body">
                Hello, world! This is a toast message.
            </div>
        </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="/static/js/user.js"></script>
<script>
    var toastLiveExample = document.getElementById('liveToast')
    var toast = new bootstrap.Toast(toastLiveExample)

    function show_toast(header, body) {
        header = header.toUpperCase()
        console.log(header + ' - ' + body);

        $('#toast-header').html(header)
        $('#toast-body').html(body)

        //if SUCCESS is in header, remove text-mu-ma class add text-mu-ha
        if (header.includes('SUCCESS')) {
            $('#toast-color').removeClass('text-danger')
            $('#toast-color').addClass('text-success')
            //change icon to check
            $('#toast-color').removeClass('bi-x-circle-fill')
            $('#toast-color').addClass('bi-check-circle')
        } else {
            $('#toast-color').removeClass('text-success')
            $('#toast-color').addClass('text-danger')
            //change icon to x
            $('#toast-color').removeClass('bi-check-circle')
            $('#toast-color').addClass('bi-x-circle-fill')
        }

        toast.show()
    }
    $(document).ready(function() {
        load_data();
    })

    function load_data(){
        $.ajax({
            url: '/api/user/get',
            type: 'GET',
            dataType: 'json',
            success: function(data){
                data = data.data
                $('#form-name').val(data.name)
                $('#form-email').val(data.email)
                $('#form-phone').val(data.phone)
            }
        });
    }

    //on btn data
    $('#btn-data').click(function(){
        var name = $('#form-name').val()
        var email = $('#form-email').val()
        var phone = $('#form-phone').val()

        $.ajax({
            url: '/api/user/update/data',
            type: 'POST',
            dataType: 'json',
            data: {
                name: name,
                email: email,
                phone: phone
            },
            success: function(data){
                if(data.status == 'success'){
                    show_toast('SUCCESS', 'Data berhasil diupdate')
                    setTimeout(() => {
                        location.reload()
                    }, 1000);
                }else{
                    show_toast('ERROR', 'Data gagal diupdate')
                }
            }
        });
    })

    //on btn password
    $('#btn-password').click(function(){
        var old_password = $('#form-old_password').val()
        var new_password = $('#form-new_password').val()
        var new_password_retype = $('#form-new_password_retype').val()

        //check new password match
        if(new_password != new_password_retype){
            show_toast('ERROR', 'Password baru tidak sama')
            return
        }

        if (old_password == '' || new_password == '' || new_password_retype == '') {
            show_toast('ERROR', 'Semua field harus diisi')
            return
        }

        $.ajax({
            url: '/api/user/update/password',
            type: 'POST',
            dataType: 'json',
            data: {
                old_password: old_password,
                new_password: new_password
            },
            success: function(data){
                if(data.status == 'success'){
                    show_toast('SUCCESS', 'Data berhasil diupdate')
                    setTimeout(() => {
                        location.reload()
                    }, 1000);
                }else{
                    show_toast('ERROR', 'Data gagal diupdate')
                }
            }
        });
    })
</script>

</html>